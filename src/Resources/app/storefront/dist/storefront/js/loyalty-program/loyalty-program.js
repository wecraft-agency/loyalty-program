(()=>{"use strict";class t{static ucFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}static lcFirst(t){return t.charAt(0).toLowerCase()+t.slice(1)}static toDashCase(t){return t.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()}static toLowerCamelCase(e,r){let i=t.toUpperCamelCase(e,r);return t.lcFirst(i)}static toUpperCamelCase(e,r){return r?e.split(r).map(e=>t.ucFirst(e.toLowerCase())).join(""):t.ucFirst(e.toLowerCase())}static parsePrimitive(t){try{return/^\d+(.|,)\d+$/.test(t)&&(t=t.replace(",",".")),JSON.parse(t)}catch(e){return t.toString()}}}class e{static isNode(t){return"object"==typeof t&&null!==t&&(t===document||t===window||t instanceof Node)}static hasAttribute(t,r){if(!e.isNode(t))throw Error("The element must be a valid HTML Node!");return"function"==typeof t.hasAttribute&&t.hasAttribute(r)}static getAttribute(t,r){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!1===e.hasAttribute(t,r))throw Error('The required property "'.concat(r,'" does not exist!'));if("function"!=typeof t.getAttribute){if(i)throw Error("This node doesn't support the getAttribute function!");return}return t.getAttribute(r)}static getDataAttribute(r,i){let o=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=i.replace(/^data(|-)/,""),a=t.toLowerCamelCase(n,"-");if(!e.isNode(r)){if(o)throw Error("The passed node is not a valid HTML Node!");return}if(void 0===r.dataset){if(o)throw Error("This node doesn't support the dataset attribute!");return}let s=r.dataset[a];if(void 0===s){if(o)throw Error('The required data attribute "'.concat(i,'" does not exist on ').concat(r,"!"));return s}return t.parsePrimitive(s)}static querySelector(t,r){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!e.isNode(t))throw Error("The parent node is not a valid HTML Node!");let o=t.querySelector(r)||!1;if(i&&!1===o)throw Error('The required element "'.concat(r,'" does not exist in parent node!'));return o}static querySelectorAll(t,r){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!e.isNode(t))throw Error("The parent node is not a valid HTML Node!");let o=t.querySelectorAll(r);if(0===o.length&&(o=!1),i&&!1===o)throw Error('At least one item of "'.concat(r,'" must exist in parent node!'));return o}static getFocusableElements(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return t.querySelectorAll('\n            input:not([tabindex^="-"]):not([disabled]):not([type="hidden"]),\n            select:not([tabindex^="-"]):not([disabled]),\n            textarea:not([tabindex^="-"]):not([disabled]),\n            button:not([tabindex^="-"]):not([disabled]),\n            a[href]:not([tabindex^="-"]):not([disabled]),\n            [tabindex]:not([tabindex^="-"]):not([disabled])\n        ')}static getFirstFocusableElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return this.getFocusableElements(t)[0]}static getLastFocusableElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=this.getFocusableElements(t);return e[e.length-1]}}class r{static iterate(t,e){if(t instanceof Map||Array.isArray(t))return t.forEach(e);if(t instanceof FormData){for(var r of t.entries())e(r[1],r[0]);return}if(t instanceof NodeList)return t.forEach(e);if(t instanceof HTMLCollection)return Array.from(t).forEach(e);if(t instanceof Object)return Object.keys(t).forEach(r=>{e(t[r],r)});throw Error("The element type ".concat(typeof t," is not iterable!"))}}class i{static serialize(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if("FORM"!==t.nodeName){if(e)throw Error("The passed element is not a form!");return{}}return new FormData(t)}static serializeJson(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],o=i.serialize(t,e);if(0===Object.keys(o).length)return{};let n={};return r.iterate(o,(t,e)=>n[e]=t),n}}let{PluginBaseClass:o}=window;class n extends o{init(){if(this._getForm(),!this._form)throw Error("No form found for the plugin: ".concat(this.constructor.name));this._prepareFormRedirect(),this._registerEvents()}_prepareFormRedirect(){try{e.querySelector(this._form,this.options.redirectSelector).value=this.options.redirectTo}catch(t){}}_getForm(){this.el&&"FORM"===this.el.nodeName?this._form=this.el:this._form=this.el.closest("form")}_registerEvents(){this.el.addEventListener("submit",this._formSubmit.bind(this))}_formSubmit(t){t.preventDefault();let r=e.getAttribute(this._form,"action"),o=i.serialize(this._form);this.$emitter.publish("beforeFormSubmit",o),this._openOffCanvasCarts(r,o)}_openOffCanvasCarts(t,e){let i=window.PluginManager.getPluginInstances("OffCanvasCart");r.iterate(i,r=>this._openOffCanvasCart(r,t,e))}_openOffCanvasCart(t,e,r){t.openOffCanvas(e,r,()=>{this.$emitter.publish("openOffCanvasCart")})}}n.options={redirectSelector:'[name="redirectTo"]',redirectTo:"frontend.cart.offcanvas"},window.PluginManager.register("AddRewardToCart",n,"[data-add-reward-to-cart]")})();